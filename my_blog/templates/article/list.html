<!-- 07 extends表明此页面继承自 base.html 文件，会加载base.html中的内容之后填充base.html的定义块 -->
{% extends "base.html" %}

{% load staticfiles %}

<!-- 07 写入 base.html 中定义的 title -->
{% block title %}
    Thousand的个人站
{% endblock title %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/article/list.css' %}">
{% endblock extra_css %}

<!-- 07 写入 base.html 中定义的 content -->
{% block content %}
<!-- 移动端 Tab 导航栏 -->
<div class="mobile-tabs d-lg-none">
    <div class="mobile-tab-item active" data-tab="articles">
        <span>文章</span>
    </div>
    <div class="mobile-tab-item" data-tab="categories">
        <span>分类/标签</span>
    </div>
    <div class="mobile-tab-item" data-tab="about">
        <span>关于</span>
    </div>
</div>

<div class="layout-shell list-page">
    <div class="container-fluid custom-container">
        <div class="content-grid">
            <!-- 左侧：个人信息 + 分类 -->
            <aside class="sidebar-left">
                <div class="card-panel profile-card text-center mb-3 mobile-content-about">
                    <div class="avatar-circle">
                        {% if profile_user.profile.avatar %}
                            <img src="{{ profile_user.profile.avatar.url }}" alt="{{ profile_user.username }}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                        {% else %}
                            <span>{{ profile_user.username|default:"T"|slice:":1"|upper }}</span>
                        {% endif %}
                    </div>
                    <h5 class="mt-3 mb-1">{{ profile_user.username|default:"Thousand" }}</h5>
                    <p class="text-muted mb-3">{{ profile_user.profile.bio|default:"Glad to meet you here, this is Thousand." }}</p>
                    <div class="social-links d-flex justify-content-center gap-3">
                        <a href="https://github.com/ThousandTech" target="_blank" class="social-icon" title="GitHub">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                            </svg>
                        </a>
                        <a href="https://space.bilibili.com/452909274" target="_blank" class="social-icon" title="哔哩哔哩">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.813 4.653h.854c1.51.054 2.769.578 3.773 1.574 1.004.995 1.524 2.249 1.56 3.76v7.36c-.036 1.51-.556 2.769-1.56 3.773s-2.262 1.524-3.773 1.56H5.333c-1.51-.036-2.769-.556-3.773-1.56S.036 18.858 0 17.347v-7.36c.036-1.511.556-2.765 1.56-3.76 1.004-.996 2.262-1.52 3.773-1.574h.774l-1.174-1.12a1.234 1.234 0 0 1-.373-.906c0-.356.124-.658.373-.907l.027-.027c.267-.249.573-.373.92-.373.347 0 .653.124.92.373L9.653 4.44c.071.071.134.142.187.213h4.267a.836.836 0 0 1 .16-.213l2.853-2.747c.267-.249.573-.373.92-.373.347 0 .662.151.929.4.267.249.391.551.391.907 0 .355-.124.657-.373.906zM5.333 7.24c-.746.018-1.373.276-1.88.773-.506.498-.769 1.13-.786 1.894v7.52c.017.764.28 1.395.786 1.893.507.498 1.134.756 1.88.773h13.334c.746-.017 1.373-.275 1.88-.773.506-.498.769-1.129.786-1.893v-7.52c-.017-.765-.28-1.396-.786-1.894-.507-.497-1.134-.755-1.88-.773zM8 11.107c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c0-.373.129-.689.386-.947.258-.257.574-.386.947-.386zm8 0c.373 0 .684.124.933.373.25.249.383.569.4.96v1.173c-.017.391-.15.711-.4.96-.249.25-.56.374-.933.374s-.684-.125-.933-.374c-.25-.249-.383-.569-.4-.96V12.44c.017-.391.15-.711.4-.96.249-.249.56-.373.933-.373Z"/>
                            </svg>
                        </a>
                        <a href="mailto:{{ profile_user.email|default:'contact@example.com' }}" class="social-icon" title="邮箱">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                            </svg>
                        </a>
                    </div>
                </div>

                <div class="card-panel category-card mb-3 mobile-content-categories">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0">分类</h6>
                    </div>
                    <ul class="list-unstyled mb-0 category-list">
                        <li>
                            <a href="?column=uncategorized&order={{ order }}" 
                               class="category-btn">
                                <span>未分类</span>
                                <span class="category-count">{{ uncategorized_count }}</span>
                            </a>
                        </li>
                        {% for col in columns %}
                            <li>
                                <a href="?column={{ col.id }}&order={{ order }}" 
                                   class="category-btn">
                                    <span>{{ col.title }}</span>
                                    <span class="category-count">{{ col.article.count }}</span>
                                </a>
                            </li>
                        {% empty %}
                            <li class="text-muted small">暂无分类</li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="card-panel category-card mobile-content-categories">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0">标签</h6>
                    </div>
                    <div class="d-flex flex-wrap gap-2">
                        {% for tag in all_tags %}
                            <a href="?tag={{ tag.name|urlencode }}" class="badge badge-secondary">
                                {{ tag }}
                            </a>
                        {% empty %}
                            <p class="text-muted small">暂无标签</p>
                        {% endfor %}
                    </div>
                </div>
            </aside>

            <!-- 中间：文章列表 -->
            <main class="main-feed">
                <div class="card-panel feed-nav">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb align-items-center flex-nowrap mb-0">
                            <li class="breadcrumb-item" style="font-size: 1.1rem;">
                                <a href="{% url 'article:article_list' %}?search={{ search }}&column={{ column }}&tag={{ tag }}"
                                   class="feed-tab {% if order == 'normal' %}active{% endif %}">
                                    最新
                                </a>
                            </li>
                            <li class="breadcrumb-item" style="font-size: 1.1rem;">
                                <a href="{% url 'article:article_list' %}?order=total_views&search={{ search }}&column={{ column }}&tag={{ tag }}"
                                   class="feed-tab {% if order == 'total_views' %}active{% endif %}">
                                    最热
                                </a>
                            </li>
                        </ol>
                    </nav>

                    <form class="form-inline feed-search" >
                        <div class="input-group">
                            <input type="text" 
                                class="form-control" 
                                name="search" 
                                placeholder="搜索文章..."
                                value="{{ search }}"
                            >
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="submit">搜索</button>
                            </div>
                        </div>
                    </form>
                </div>

                {% if search %}
                    {% if articles %}
                        <div class="card-panel mb-3" style="color: var(--muted);">
                            <strong>“{{ search }}”</strong> 的搜索结果如下：
                        </div>
                    {% else %}
                        <div class="card-panel mb-3" style="color: var(--muted);">
                            暂无 “{{ search }}” 相关的文章。
                        </div>
                    {% endif %}
                {% endif %}

                {% for article in articles %}
                    <div class="card-panel article-card">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div class="article-tags-wrapper">
                                {% if article.column %}
                                    {% widthratio article.column.id 1 60 as hue %}
                                    <a href="{% url 'article:article_list' %}?column={{ article.column.id }}" 
                                        class="btn btn-sm column-tag"
                                        style="--hue: {{ hue }};"
                                    >
                                        {{ article.column }}
                                    </a>
                                {% endif %}
                                {% for tag in article.tags.all %}
                                    <a href="{% url 'article:article_list' %}?tag={{ tag.name|urlencode }}" 
                                    class="badge badge-secondary"
                                    >
                                        {{ tag }}
                                    </a>
                                {% endfor %}
                            </div>
                            <span class="article-meta text-nowrap ml-2">{{ article.updated|date:'Y-m-d' }} 更新</span>
                        </div>

                        <h4 class="article-title">
                            <a href="{% url 'article:article_detail' article.id %}">
                                {{ article.title }}
                            </a>
                        </h4>

                        <p class="article-meta">{{ article.body|slice:'120' }}...</p>

                        <div class="article-meta mt-2">
                            <span>{{ article.total_views }} 浏览</span>
                            <span>{{ article.created|date:'Y-m-d' }} 发布</span>
                        </div>
                    </div>
                {% endfor %}

                <!-- 页码导航 -->
                {% if articles.paginator.num_pages > 1 %}
                <div class="pagination row pagination-row">
                    <div class="m-auto">
                        <span class="step-links">
                            {% if articles.has_previous %}
                                <a href="?page=1&order={{ order }}&search={{ search }}&column={{ column }}&tag={{ tag }}" class="btn btn-success">&laquo; 1</a>
                                <span class="text-muted">...</span>
                                <a href="?page={{ articles.previous_page_number }}&order={{ order }}&search={{ search }}&column={{ column }}&tag={{ tag }}" 
                                class="btn btn-secondary"
                                >
                                    {{ articles.previous_page_number }}
                                </a>
                            {% endif %}

                            <span class="btn btn-primary btn-lg">
                                {{ articles.number }}
                            </span>

                            {% if articles.has_next %}
                                <a href="?page={{ articles.next_page_number }}&order={{ order }}&search={{ search }}&column={{ column }}&tag={{ tag }}"
                                class="btn btn-secondary">{{ articles.next_page_number }}</a>
                                <span class="text-muted">...</span>
                                <a href="?page={{ articles.paginator.num_pages }}&order={{ order }}&search={{ search }}&column={{ column }}&tag={{ tag }}"
                                class="btn btn-success">{{ articles.paginator.num_pages }} &raquo;</a>
                            {% endif %}
                        </span>
                    </div>
                </div>
                {% endif %}
            </main>

            <!-- 右侧预留区域：空白块与左栏同宽，高为个人信息卡片的1.5倍 -->
            <aside class="sidebar-right mobile-content-about">
                <div class="card-panel mb-3" id="earth-time-panel">
                    <h5 class="mb-3">地球</h5>
                    <div class="monitor-info">
                        <div class="d-flex justify-content-between mb-0">
                            <span>标准时间</span>
                        </div>
                        <div class="mt-1 mb-2">
                            <span id="utc-time" class="text-muted small" style="font-size: 0.85rem; color: #9aa3b0 !important;">...</span>
                        </div>
                        <div class="d-flex justify-content-between mb-0">
                            <span>本地时间</span>
                        </div>
                        <div class="mt-1 mb-2">
                            <span id="local-time" class="text-muted small" style="font-size: 0.85rem; color: #9aa3b0 !important;">...</span>
                        </div>
                    </div>
                </div>

                <div class="card-panel mb-3" id="admin-status-panel">
                    <h5 class="mb-3">管理员</h5>
                    <div id="admin-status-content">
                        <div class="d-flex justify-content-between mb-0">
                            <span>状态(根据终端使用情况推测)</span>
                        </div>
                        <div class="mt-1 mb-2">
                            <span class="small" id="admin-state-text" style="font-size: 0.85rem;">检测中...</span>
                        </div>
                        <div class="d-flex justify-content-between mb-0">
                            <span>运行时长</span>
                        </div>
                        <div class="mt-1">
                            <span class="text-muted small" id="live-time" style="font-size: 0.85rem; color: #9aa3b0 !important;"></span>
                        </div>
                    </div>
                </div>

                <div class="card-panel mb-3" id="terminal-status-panel">
                    <h5 class="mb-3">通讯终端</h5>
                    <div id="terminal-status-content">
                        <p class="text-muted small">正在获取数据...</p>
                    </div>
                </div>

                <div class="card-panel mb-3">
                    <h5 class="mb-3">服务器</h5>
                    
                    <div class="monitor-info mb-3">
                        <div class="d-flex justify-content-between mb-0">
                            <span>系统版本</span>
                        </div>
                        <div class="mt-1 mb-2">
                            <span id="system-version" class="text-muted small" style="font-size: 0.85rem; color: #9aa3b0 !important;">...</span>
                        </div>

                        <div class="d-flex justify-content-between mb-0">
                            <span>主机名</span>
                        </div>
                        <div class="mt-1 mb-2">
                            <span id="hostname" class="text-muted small" style="font-size: 0.85rem; color: #9aa3b0 !important;">...</span>
                        </div>

                        <div class="d-flex justify-content-between mb-0">
                            <span>CPU</span>
                        </div>
                        <div class="mt-1 mb-2">
                            <span id="cpu-name" class="text-muted small" style="font-size: 0.85rem; color: #9aa3b0 !important;">...</span>
                        </div>

                        <div class="d-flex justify-content-between mb-0">
                            <span>运行时长</span>
                        </div>
                        <div class="mt-1 mb-2">
                            <span id="uptime" class="text-muted small" style="font-size: 0.85rem; color: #9aa3b0 !important;">...</span>
                        </div>
                    </div>

                    <div class="monitor-metric mb-3">
                        <div class="d-flex justify-content-between mb-0">
                            <span>CPU使用率</span>
                        </div>
                        <div class="mt-1 mb-2">
                            <div class="metric-bar">
                                <div id="cpu-bar" class="metric-bar-fill"></div>
                                <div class="metric-text-overlay">
                                    <span id="cpu-percent-text">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="monitor-metric mb-3">
                        <div class="d-flex justify-content-between mb-0">
                            <span>内存使用率</span>
                        </div>
                        <div class="mt-1 mb-2">
                            <div class="metric-bar">
                                <div id="mem-bar" class="metric-bar-fill"></div>
                                <div class="metric-text-overlay">
                                    <span id="mem-percent-text">0%</span>
                                    <span id="mem-usage-text">0G/0G</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="monitor-chart mb-3">
                        <div class="d-flex justify-content-between mb-0">
                            <span>磁盘 I/O</span>
                        </div>
                        <div class="mt-1 mb-2 position-relative">
                            <div class="position-absolute" style="top: 0; right: 0; z-index: 10;">
                                <span id="disk-r-indicator" class="net-indicator net-up mr-2 small" style="font-size: 0.85rem;"></span>
                                <span id="disk-w-indicator" class="net-indicator net-down small" style="font-size: 0.85rem;"></span>
                            </div>
                            <div id="disk-chart" style="width: 100%; height: 120px;"></div>
                        </div>
                    </div>

                    <div class="monitor-chart mb-3">
                        <div class="d-flex justify-content-between mb-0">
                            <span>网络流量</span>
                        </div>
                        <div class="mt-1 mb-2 position-relative">
                            <div class="position-absolute" style="top: 0; right: 0; z-index: 10;">
                                <span id="net-up-indicator" class="net-indicator net-up mr-2 small" style="font-size: 0.85rem;"></span>
                                <span id="net-down-indicator" class="net-indicator net-down small" style="font-size: 0.85rem;"></span>
                            </div>
                            <div id="network-chart" style="width: 100%; height: 120px;"></div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>
</div>
    <div id="monitor-config" class="d-none" data-monitor-info-url="{% url 'monitor:info' %}" data-monitor-state-url="{% url 'monitor:state' %}" data-monitor-terminal-url="{% url 'monitor:terminal_latest' %}"></div>
{% endblock content %}

{% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/echarts@4/dist/echarts.min.js"></script>
    <script src="{% static 'js/monitor.js' %}"></script>
    <script src="{% static 'js/article/list.js' %}?v=20260119"></script>
{% endblock extra_js %}
